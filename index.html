<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Finance App</title>
    <link rel="stylesheet" href="styles.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Meta tags per PWA -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Finance">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Per la status bar nera su iPhone -->
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">

    <!-- Icone per iOS -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Registrazione Service Worker -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then(registration => console.log('SW registrato:', registration))
            .catch(error => console.log('SW errore:', error));
        });
    }
    </script>

</head>
<body>
    <!-- Header -->
        <header class="app-header">
            <h1 id="pageTitle" class="header-title">üí∞ Dashboard</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-dot loading"></span>
                <span class="status-text">Connessione...</span>
            </div>
        </header>
    <div class="app-container">
        <!-- Main Content -->
        <main class="app-main">
            <!-- Dashboard Page -->
            <section id="dashboardPage" class="page active">
                <div class="dashboard-grid">
                    <!-- Net Worth Card -->
                    <div class="balance-card">
                        <div class="balance-amount" id="totalBalance">‚Ç¨ 0,00</div>
                        <div class="balance-label">Net Worth</div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="stats-grid">
                        <div class="stat-card stat-card--income">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-content">
                                <div class="stat-value" id="monthlyIncome">‚Ç¨ 0</div>
                                <div class="stat-label">Entrate mese</div>
                                <div class="stat-change" id="incomeChange">+0%</div>
                            </div>
                        </div>
                        <div class="stat-card stat-card--expense">
                            <div class="stat-icon">üìâ</div>
                            <div class="stat-content">
                                <div class="stat-value" id="monthlyExpenses">‚Ç¨ 0</div>
                                <div class="stat-label">Uscite mese</div>
                                <div class="stat-change" id="expenseChange">+0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Saving Rate Card -->
                    <div class="saving-rate-card">
                        <div class="saving-rate-content">
                            <div class="saving-rate-icon">üéØ</div>
                            <div class="saving-rate-info">
                                <div class="saving-rate-value" id="savingRate">0%</div>
                                <div class="saving-rate-label">Saving Rate</div>
                                <div class="saving-rate-change" id="savingRateChange">+0%</div>
                            </div>
                            <div class="saving-rate-indicator" id="savingRateIndicator">
                                <div class="indicator-text">Neutro</div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Card -->
                    <div class="analytics-card">
                        <div class="card-title">üìä Analytics Avanzate</div>
                        <div class="analytics-content">
                            <p>Visualizza report dettagliati e grafici avanzati</p>
                            <button class="btn btn--analytics" onclick="openLookerStudio()">
                                üöÄ Apri Dashboard
                            </button>
                        </div>
                    </div>

                    <!-- Accounts List -->
                    <div class="card">
                        <div class="card-title">üè¶ I tuoi conti</div>
                        <div class="accounts-list" id="accountsList">
                            <div class="skeleton skeleton--text"></div>
                            <div class="skeleton skeleton--text"></div>
                            <div class="skeleton skeleton--text"></div>
                        </div>
                    </div>

                    <!-- Recent Transactions -->
                    <div class="card">
                        <div class="card-title">
                            üïí Transazioni recenti
                            <button class="btn btn--small" onclick="changePage('transaction')">
                                Vedi tutte
                            </button>
                        </div>
                        <div id="recentTransactions">
                            <div class="skeleton skeleton--text"></div>
                            <div class="skeleton skeleton--text"></div>
                            <div class="skeleton skeleton--text"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transactions Page -->
            <section id="transactionPage" class="page">
                <div class="card">
                    <div class="card-title">
                        üí∞ Ultime Transazioni
                        <button class="btn btn--primary" onclick="changePage('addTransaction')">
                            <span>+</span> Nuova
                        </button>
                    </div>
                    <div class="transactions-list" id="transactionsList">
                        <div class="skeleton skeleton--text"></div>
                        <div class="skeleton skeleton--text"></div>
                        <div class="skeleton skeleton--text"></div>
                    </div>
                </div>
            </section>

            <!-- Add Transaction Page -->
            <section id="addTransactionPage" class="page">
                <div class="form-container">
                    <form id="transactionForm" class="transaction-form">
                        <!-- Transaction Type -->
                        <div class="form-group">
                            <div class="tipo-buttons">
                                <button type="button" class="tipo-btn tipo-btn--expense active" data-tipo="spesa">
                                    üì§ Spesa
                                </button>
                                <button type="button" class="tipo-btn tipo-btn--income" data-tipo="entrata">
                                    üì• Entrata
                                </button>
                                <button type="button" class="tipo-btn tipo-btn--transfer" data-tipo="trasferimento">
                                    üîÑ Trasferimento
                                </button>
                            </div>
                            <input type="hidden" id="tipo" name="tipo" value="spesa">
                        </div>

                        <!-- Amount -->
                        <div class="form-group form-group--amount">
                            <label class="form-label form-label--large" for="importo">Importo ‚Ç¨</label>
                            <input type="text" 
                                   id="importo" 
                                   name="importo" 
                                   class="form-input form-input--amount"
                                   placeholder="0,00"
                                   inputmode="decimal"
                                   required>
                        </div>

                        <!-- Account -->
                        <div class="form-group">
                            <label class="form-label" for="conto">Conto</label>
                            <select id="conto" name="conto" class="form-select" required>
                                <option value="">üì° Caricamento...</option>
                            </select>
                        </div>

                        <!-- Destination Account (hidden by default) -->
                        <div class="form-group hidden" id="contoDestinazioneGroup">
                            <label class="form-label" for="contoDestinazione">Conto destinazione</label>
                            <select id="contoDestinazione" name="contoDestinazione" class="form-select">
                                <option value="">Seleziona destinazione...</option>
                            </select>
                        </div>

                        <!-- Category -->
                        <div class="form-group" id="categoriaGroup">
                            <label class="form-label" for="categoria">Categoria</label>
                            <select id="categoria" name="categoria" class="form-select" required>
                                <option value="">üì° Caricamento...</option>
                            </select>
                        </div>

                        <!-- Subcategory -->
                        <div class="form-group" id="sottocategoriaGroup">
                            <label class="form-label" for="sottocategoria">Sottocategoria</label>
                            <select id="sottocategoria" name="sottocategoria" class="form-select">
                                <option value="">Prima seleziona la categoria</option>
                            </select>
                        </div>

                        <!-- Description -->
                        <div class="form-group autocomplete-container">
                            <label class="form-label" for="descrizione">Descrizione</label>
                            <input type="text" 
                                   id="descrizione" 
                                   name="descrizione" 
                                   class="form-input"
                                   placeholder="Inizia a scrivere..."
                                   autocomplete="off">
                            <div id="descrizioneSuggestions" class="autocomplete-suggestions"></div>
                        </div>

                        <!-- Tags -->
                        <div class="form-group">
                            <label class="form-label">Etichette</label>
                            <div class="tags-container">
                                <div class="tags-display" id="tagsDisplay">
                                    <input type="text" 
                                           class="tags-input" 
                                           id="tagsInput" 
                                           placeholder="Aggiungi etichetta e premi Invio">
                                </div>
                                <input type="hidden" id="etichetta" name="etichetta">
                            </div>
                        </div>

                        <!-- Date -->
                        <div class="form-group">
                            <label class="form-label" for="data">Data</label>
                            <input type="date" id="data" name="data" class="form-input" required>
                        </div>

                    </form>

                    <div id="message" class="message hidden"></div>
                </div>
            </section>

            <!-- Shared Page -->
            <section id="sharedPage" class="page">
                <div class="card">
                    <div class="card-title">üë• Transazioni Condivise</div>
                    <div style="text-align: center; padding: 60px 20px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üöß</div>
                        <div style="font-weight: 500; margin-bottom: 8px;">Sezione in costruzione</div>
                        <div style="font-size: 14px; color: #999;">
                            Qui potrai vedere le transazioni condivise con altri utenti
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="settingsPage" class="page">
                <div class="settings-grid">
                    <!-- Analytics Dashboard -->
                    <div class="card">
                        <div class="card-title">üìä Dashboard Analytics</div>
                        <div class="settings-item">
                            <div class="settings-description">
                                <div class="settings-label">Dashboard Completa</div>
                                <div class="settings-sublabel">Grafici avanzati e analisi dettagliate</div>
                            </div>
                            <button class="btn btn--primary" onclick="openLookerStudio()">
                                üöÄ Apri Looker Studio
                            </button>
                        </div>
                    </div>

                    <!-- Google Sheet -->
                    <div class="card">
                        <div class="card-title">üìã Gestione Dati</div>
                        <div class="settings-item">
                            <div class="settings-description">
                                <div class="settings-label">Google Sheet</div>
                                <div class="settings-sublabel">Accesso diretto ai dati</div>
                            </div>
                            <button class="btn btn--primary" onclick="openGoogleSheet()">
                                üìä Apri Spreadsheet
                            </button>
                        </div>
                    </div>

                    <!-- App Info -->
                    <div class="card">
                        <div class="card-title">‚ÑπÔ∏è Informazioni App</div>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Versione</span>
                                <span class="info-value">v1.5 PWA</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ultima connessione</span>
                                <span class="info-value" id="lastConnection">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Stato</span>
                                <span class="info-value" id="appStatus">üü¢ Operativo</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="nav-item" data-page="transaction">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Transazioni</span>
            </button>
            <button class="nav-item nav-item--add" data-page="addTransaction">
                <span class="nav-icon nav-icon--add">+</span>
                <span class="nav-label">Aggiungi</span>
            </button>
            <button class="nav-item" data-page="shared">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Condivise</span>
            </button>
            <button class="nav-item" data-page="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Impostazioni</span>
            </button>
        </nav>

        <!-- Sticky Submit Button (only visible on add transaction page) -->
        <div class="sticky-submit" id="stickySubmit">
            <button type="submit" form="transactionForm" class="btn btn--submit btn--expense" id="submitBtnSticky">
                <span id="submitTextSticky">Salva Transazione</span>
                <span id="submitSpinnerSticky" class="spinner hidden"></span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
